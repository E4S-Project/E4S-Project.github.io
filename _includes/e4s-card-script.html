<script>
// ---- Flip behavior: touch devices tap; desktop click handled by CSS ----

// ---- DEVICE DETECTION ----
const isTouchDevice =
  'ontouchstart' in window ||
  navigator.maxTouchPoints > 0 ||
  navigator.msMaxTouchPoints > 0;

// ---- FLIP BEHAVIOR: CLICK/TAP ON ALL DEVICES ----
document.querySelectorAll('.feature-item').forEach(item => {
  const backButton = item.querySelector('.flip-back');

  // Flip on click/tap everywhere (desktop + touch)
  item.addEventListener('click', e => {
    // Do not flip if user clicked a link or a button
    if (e.target.closest('a, button')) return;

    // Toggle flip state
    item.classList.toggle('flipped');
  });

  // Explicit "flip-back" button, if present
  if (backButton) {
    backButton.addEventListener('click', e => {
      e.stopPropagation();
      item.classList.remove('flipped');
    });
  }
});


function sizeCards() {
  const items = document.querySelectorAll('.feature-item');
  if (!items.length) return;

  let maxH = 240; // minimum floor, same idea as before

  // First pass: measure each card, find max height
  items.forEach(item => {
    // put card in "measuring" mode so faces flow naturally
    item.classList.add('measuring');
    // clear previous height so we can measure natural height
    item.style.setProperty('--card-h', 'auto');

    const front = item.querySelector('.card-front');
    const back  = item.querySelector('.card-back');

    const hFront = front ? front.scrollHeight : 0;
    const hBack  = back  ? back.scrollHeight  : 0;

    const h = Math.max(hFront, hBack, 240);
    if (h > maxH) {
      maxH = h;
    }

    item.classList.remove('measuring');
  });

  // tiny buffer and apply same height to all cards
  maxH = maxH + 2;
  items.forEach(item => {
    item.style.setProperty('--card-h', maxH + 'px');
  });
}

// Recompute on load, after fonts, and on resize
window.addEventListener('load', sizeCards);
window.addEventListener('resize', () => { sizeCards(); });

const grid = document.querySelector('.feature-grid');
if (window.ResizeObserver && grid) {
  const ro = new ResizeObserver(() => sizeCards());
  ro.observe(grid);
}

setTimeout(sizeCards, 300);
</script>
