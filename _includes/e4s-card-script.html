<script>
// ---- Flip behavior: touch devices tap; desktop click handled by CSS ----

// ---- DEVICE DETECTION ----
const isTouchDevice =
  'ontouchstart' in window ||
  navigator.maxTouchPoints > 0 ||
  navigator.msMaxTouchPoints > 0;

// ---- FLIP BEHAVIOR: CLICK/TAP ON ALL DEVICES ----
document.querySelectorAll('.feature-item').forEach(item => {
  const backButton = item.querySelector('.flip-back');

  // Flip on click/tap everywhere (desktop + touch)
  item.addEventListener('click', e => {
    // Do not flip if user clicked a link or a button
    if (e.target.closest('a, button')) return;

    // Toggle flip state
    item.classList.toggle('flipped');
  });

  // Explicit "flip-back" button, if present
  if (backButton) {
    backButton.addEventListener('click', e => {
      e.stopPropagation();
      item.classList.remove('flipped');
    });
  }
});

/* ---- Auto-size each card to its tallest face ----
   Measures natural heights (front & back), sets --card-h per card,
   and re-measures on load/resize/grid reflow.
*/
function sizeCards() {
  const items = document.querySelectorAll('.feature-item');
  if (!items.length) return;

  items.forEach(item => {
    // put card in "measuring" mode so faces flow naturally
    item.classList.add('measuring');
    // clear previous height so we can measure natural height
    item.style.setProperty('--card-h', 'auto');

    const front = item.querySelector('.card-front');
    const back  = item.querySelector('.card-back');

    // read natural heights
    const hFront = front ? front.scrollHeight : 0;
    const hBack  = back  ? back.scrollHeight  : 0;

    // choose the tallest + a tiny buffer
    const h = Math.max(hFront, hBack, 240) + 2;

    // apply height to the card
    item.style.setProperty('--card-h', h + 'px');

    // leave measuring mode
    item.classList.remove('measuring');
  });
}

// Recompute on load, after fonts, and on resize
window.addEventListener('load', sizeCards);
window.addEventListener('resize', () => { sizeCards(); });

// Recompute when the grid layout changes size (e.g., responsive columns)
const grid = document.querySelector('.feature-grid');
if (window.ResizeObserver && grid) {
  const ro = new ResizeObserver(() => sizeCards());
  ro.observe(grid);
}

// If content/fonts load late in Minimal-Mistakes, a small post-load nudge helps
setTimeout(sizeCards, 300);
</script>
